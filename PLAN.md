# План реализации функций AI-обработки статей

## Цель проекта
Добавить функциональность для трех кнопок: "О чем статья?", "Тезисы", "Пост для Telegram", которые используют AI для обработки распарсенного контента статьи.

## Текущее состояние
- ✅ Реализован парсинг статей (API `/api/parse`)
- ✅ Реализован перевод статей (API `/api/translate`)
- ✅ Интерфейс с кнопками создан
- ⏳ Функции кнопок используют моки и требуют реализации

## Порядок действий

### Этап 1: Создание API routes для AI-обработки

#### 1.1. Создать API route для "О чем статья?" (`/app/api/summary/route.ts`)
- **Функция**: Генерация краткого описания статьи
- **Входные данные**: 
  - `content` (string) - распарсенный контент статьи
  - `title` (string, опционально) - заголовок статьи
- **Логика**:
  1. Получить API ключ из `process.env.OPENROUTER_API_KEY`
  2. Отправить запрос к OpenRouter API с моделью `nvidia/nemotron-3-nano-30b-a3b:free`
  3. System prompt: "Ты эксперт по анализу статей. Создай краткое описание статьи (2-3 предложения), объясняющее основную тему и ключевые моменты."
  4. User prompt: "О чем эта статья? Заголовок: {title}\n\nКонтент: {content}"
  5. Вернуть результат в формате `{ summary: string }`
- **Обработка ошибок**: Валидация входных данных, проверка API ключа, обработка ошибок OpenRouter

#### 1.2. Создать API route для "Тезисы" (`/app/api/theses/route.ts`)
- **Функция**: Генерация списка тезисов статьи
- **Входные данные**: 
  - `content` (string) - распарсенный контент статьи
  - `title` (string, опционально) - заголовок статьи
- **Логика**:
  1. Получить API ключ из `process.env.OPENROUTER_API_KEY`
  2. Отправить запрос к OpenRouter API с моделью `nvidia/nemotron-3-nano-30b-a3b:free`
  3. System prompt: "Ты эксперт по анализу статей. Создай список основных тезисов статьи в формате маркированного списка. Каждый тезис должен быть кратким и информативным."
  4. User prompt: "Создай тезисы для этой статьи. Заголовок: {title}\n\nКонтент: {content}"
  5. Вернуть результат в формате `{ theses: string }`
- **Обработка ошибок**: Валидация входных данных, проверка API ключа, обработка ошибок OpenRouter

#### 1.3. Создать API route для "Пост для Telegram" (`/app/api/telegram/route.ts`)
- **Функция**: Генерация поста для Telegram канала
- **Входные данные**: 
  - `content` (string) - распарсенный контент статьи
  - `title` (string, опционально) - заголовок статьи
  - `url` (string, опционально) - URL статьи
- **Логика**:
  1. Получить API ключ из `process.env.OPENROUTER_API_KEY`
  2. Отправить запрос к OpenRouter API с моделью `nvidia/nemotron-3-nano-30b-a3b:free`
  3. System prompt: "Ты эксперт по созданию контента для социальных сетей. Создай привлекательный пост для Telegram канала на основе статьи. Пост должен быть кратким, информативным и содержать призыв к действию."
  4. User prompt: "Создай пост для Telegram на основе этой статьи. Заголовок: {title}\n\nКонтент: {content}\n\nURL: {url}"
  5. Вернуть результат в формате `{ post: string }`
- **Обработка ошибок**: Валидация входных данных, проверка API ключа, обработка ошибок OpenRouter

### Этап 2: Обновление клиентского кода

#### 2.1. Обновить функцию `handleAction` в `/app/page.tsx`
- **Текущее состояние**: Функция использует моки с `setTimeout`
- **Изменения**:
  1. Удалить моки и `setTimeout`
  2. Добавить реальные API вызовы для каждого типа действия:
     - `"summary"` → `/api/summary`
     - `"theses"` → `/api/theses`
     - `"telegram"` → `/api/telegram`
  3. Передавать в API:
     - `content` из `parsedData.content`
     - `title` из `parsedData.title` (если доступен)
     - `url` из состояния `url` (для Telegram поста)
  4. Обработать ответ и установить результат в `setResult()`
  5. Добавить обработку ошибок с понятными сообщениями

#### 2.2. Добавить проверку наличия распарсенных данных
- Перед вызовом API проверить, что `parsedData` и `parsedData.content` существуют
- Если данных нет, показать alert: "Сначала распарсите статью"
- Блокировать кнопки, если статья не распарсена

### Этап 3: Тестирование и оптимизация

#### 3.1. Локальное тестирование
- Протестировать каждую функцию с реальными статьями
- Проверить обработку ошибок (отсутствие API ключа, ошибки сети, невалидные данные)
- Проверить работу с длинными статьями (возможна необходимость разбиения на части)

#### 3.2. Оптимизация промптов
- Протестировать разные варианты system prompts для лучшего качества результатов
- Настроить параметр `temperature` для каждого типа задачи:
  - Summary: 0.3-0.5 (более детерминированный)
  - Theses: 0.4-0.6 (баланс между структурированностью и креативностью)
  - Telegram: 0.5-0.7 (более креативный подход)

#### 3.3. Обработка длинных статей
- Если статья слишком длинная, рассмотреть:
  - Разбиение на части и обработку по частям
  - Или отправку только первых N символов с предупреждением
  - Или использование streaming API для постепенной генерации

### Этап 4: Документация и финализация

#### 4.1. Обновить README.md
- Добавить описание новых функций
- Указать требования к API ключу OpenRouter
- Добавить примеры использования

#### 4.2. Проверка деплоя
- Убедиться, что переменная окружения `OPENROUTER_API_KEY` настроена в Vercel
- Протестировать работу всех функций на production

## Технические детали

### Используемые технологии
- **API**: OpenRouter AI (https://openrouter.ai/api/v1/chat/completions)
- **Модель**: `nvidia/nemotron-3-nano-30b-a3b:free`
- **Backend**: Next.js API Routes
- **Frontend**: React с TypeScript

### Структура API запросов
Все три API route будут иметь схожую структуру:
```typescript
POST /api/{endpoint}
Body: {
  content: string,
  title?: string,
  url?: string
}
Response: {
  result: string
}
```

### Переменные окружения
- `OPENROUTER_API_KEY` - обязательная переменная для работы всех AI функций

## Приоритет реализации
1. **Высокий**: API route для "О чем статья?" (базовая функциональность)
2. **Высокий**: API route для "Тезисы" (структурированный вывод)
3. **Средний**: API route для "Пост для Telegram" (специфичный формат)

## Оценка времени
- Создание API routes: ~2-3 часа
- Обновление клиентского кода: ~1 час
- Тестирование и отладка: ~2 часа
- Оптимизация и финализация: ~1 час

**Итого**: ~6-7 часов работы

